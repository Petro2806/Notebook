\section*{min= and sum with Segment Tree}

Store in each node: $max$, $cntMax$, $max2$, $sum$

In update check $l$, $r$ conditions and: 
\begin{itemize}
\item if ($val \ge max$) return;
\item else if ($val > max2$) update this node;
\item else go to left and right
\end{itemize}

You can do max= and += on segment at the same time.
Time: $O(\log n)$. Each extra descent decreases number of diferent elements in segment. 
